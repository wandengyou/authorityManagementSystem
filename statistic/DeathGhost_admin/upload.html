<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"/>
<title>权限管理系统</title>
<meta name="author" content="wandengyou" />
<meta name="renderer" content="webkit">
<meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
<link rel="icon" href="images/icon/favicon.ico" type="image/x-icon">
<link rel="stylesheet" type="text/css" href="css/style.css" />
<script src="javascript/plug-ins/layerUi/layer.js"></script>
<script src="javascript/jquery.js"></script>
<script src="js/urls.js"></script>
<script src="js/utils.js"></script>
<script src="js/user.js"></script>
</head>
<script type="text/javascript">
	function fill_permission_template(form_handle, ajax_response){
		if(ajax_response['code'] == 200){
			form_handle.empty()
			var permissions = ajax_response['data']['data']
			var total = ajax_response['data']['total']
			$.each(permissions, function(index, permission){
				var tr = '<tr class="cen">'+
					// '<td><input type="checkbox" class="permission_checkbox" name="'+permission['permission_code']+'"/></td>'+
					'<td>'+permission['permission_name']+'</td>'+
					// '<td>'+permission['permission_code']+'</td>'+
					'<td>'+permission['permission_type']+'</td>'+
					'<td>'+permission['identifier']+'</td>'+
				'</tr>'
				form_handle.append(tr)
			})
			$("#total").text('合计：'+total)
			// form_handle.append('<p style="padding-left: 25px;">合计：'+total+'</p>')
		}
	}
	
	$(function(){
		var index = parent.layer.getFrameIndex(window.name); //获取窗口索引
		var request_params = getRequest()
		
		$('#file').on('change',function () {
			var filepath = $(this).val()
			var extStart = filepath.lastIndexOf(".")
			var ext = filepath.substring(extStart, filepath.length).toUpperCase();
			if(ext == '.JSON'){
				var host = 'http://192.168.0.14:1234/auth/'
				// 获取file标签选择器的文件
				var file_obj = $('#file').get(0).files[0];
				// 将文件对象打包成form表单类型的数据
				var formdata = new FormData;
				formdata.append('file',file_obj);
				// 进行文件数据的上传
				$.ajax({
					url:host+'import/'+request_params.platform_code+"/",
					type:'post',
					data:formdata,
					processData:false,
					contentType:false,
					success:function(res) {
						fill_permission_template($('#permission tbody'), res)
					},
				});
			}
			else{
				alert("文件格式必须为:.json")
			}
		});
	})
</script>

<body>
	<div style="padding-left: 25px;">
		文件: <input type="file" id="file" name="file">   
		<br>
		注：权限类型：0: 表示菜单权限，1：接口权限
		<br>
		注：权限标识格式：a.b.c(a：一级，b：2级，c：三级，以此类推)
	</div>
	<table class="table mb-15" id="permission">
		<thead>
			<tr>
				<th>权限名称</th>
				<th>权限类型</th>
				<th>权限标识</th>
			</tr>
		</thead>
		<tbody>
		</tbody>
	</table>
	<p id="total" style="text-align: center;"></p>
</body>
</html>
